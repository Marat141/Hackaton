name: Upload Markdown to Turso

on:
  push:
    branches:
      - Content  # Tento workflow se spustí při každém pushnutí do větve Content
    paths:
      - 'content/**/*'  # Better glob pattern for any markdown files in content/

jobs:
  upload-markdown:
    runs-on: ubuntu-latest
    
    # ADD THIS: Define the secrets that this job needs
    permissions:
      contents: read
      checks: write
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4  # Updated to v4

      - name: Set up Node.js
        uses: actions/setup-node@v4  # Updated to v4
        with:
          node-version: '20'  # Updated to current LTS
          cache: 'npm'  # Cache dependencies for faster runs

      - name: Install dependencies
        run: npm ci  # Use `npm ci` for clean install in CI

      - name: Log environment variables (for debugging)
        run: |
          echo "Checking if secrets are available..."
          if [ -n "$DATABASE_URL" ]; then 
            echo "DATABASE_URL is set (first 20 chars): ${DATABASE_URL:0:20}..."
          else 
            echo "DATABASE_URL is NOT set"
          fi
          
          if [ -n "$DATABASE_AUTH_TOKEN" ]; then 
            echo "DATABASE_AUTH_TOKEN is set (exists)"
          else 
            echo "DATABASE_AUTH_TOKEN is NOT set"
          fi

      - name: Run script to upload markdown
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          DATABASE_AUTH_TOKEN: ${{ secrets.DATABASE_AUTH_TOKEN }}
        run: |
          node upload-markdown.js  # Make sure this file exists!